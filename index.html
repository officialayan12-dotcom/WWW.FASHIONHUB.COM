<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Fashion Hub — Multi-language E-Commerce</title>
  <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;700&display=swap" rel="stylesheet">
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    body { font-family: 'Playfair Display', serif; background: linear-gradient(135deg,#1a1a1a 0%,#333 100%); color:#f0f0f0; min-height:100vh; }
    .gold-text { color:#ffd700; }
    .premium-button { background: linear-gradient(135deg,#ffd700 0%,#ffed4e 100%); color:#1a1a1a; transition: all .25s; }
    .premium-button:hover { transform: scale(1.02); }
    .product-card { background: rgba(255,255,255,0.03); border:1px solid rgba(255,215,0,0.08); backdrop-filter: blur(6px); }
    .eye-btn { position:absolute; right:10px; top:50%; transform:translateY(-50%); cursor:pointer; color:#ffd700; user-select:none; }
    .modal-tab-button { background: rgba(255,215,0,0.06); color:#ffd700; padding:.5rem 1rem; border-radius:.5rem; }
    .modal-tab-button.active { background:#ffd700; color:#1a1a1a; }
    .small-btn { background:#2d2d2d; padding:.4rem .6rem; border-radius:.4rem; color:#fff; }
    .badge { background:#111; padding:.2rem .4rem; border-radius:.4rem; border:1px solid rgba(255,255,255,0.05); }
    table { width:100%; border-collapse: collapse; }
    th, td { padding:.6rem; border-bottom:1px solid rgba(255,255,255,0.04); text-align:left; }
  </style>
</head>
<body class="text-gray-100">

  <header class="bg-gradient-to-r from-gray-900 to-black shadow-lg sticky top-0 z-30 p-4">
    <div class="container mx-auto flex flex-col md:flex-row items-center justify-between gap-4">
      <div class="flex items-center gap-4">
        <h1 class="text-3xl font-bold gold-text">Fashion Hub</h1>
        <p id="powered-by" class="text-sm text-gray-300">Powered by Meman Ayan</p>
      </div>

      <nav class="flex items-center gap-4">
        <a href="#products" class="text-gray-300 hover:underline" data-key="nav_products">Products</a>
        <a href="#return-policy" class="text-gray-300 hover:underline" data-key="nav_return">Return Policy</a>
        <a href="#contact" class="text-gray-300 hover:underline" data-key="nav_contact">Contact</a>
        <button id="mainLoginBtn" class="premium-button px-4 py-2 rounded font-semibold" onclick="openLoginModal()" data-key="btn_login">Login</button>

        <div id="logged-in-options" class="hidden flex items-center gap-2">
          <button id="profileNavBtn" class="premium-button px-3 py-2 rounded" onclick="showCustomerProfile()" data-key="btn_profile">My Profile</button>
          <button id="dashboardBtn" class="bg-gray-700 text-white px-3 py-2 rounded hidden" onclick="showAdminPanel()" data-key="btn_dashboard">My Dashboard</button>
          <button id="logoutBtnTop" class="bg-red-600 text-white px-3 py-2 rounded hidden" onclick="logoutUser()" data-key="btn_logout">Logout</button>
        </div>

        <select id="langSelect" class="bg-gray-800 text-white rounded p-2" onchange="setLanguage(this.value)">
          <option value="en">English</option>
          <option value="hi">हिन्दी</option>
          <option value="gu">ગુજરાતી</option>
        </select>
      </nav>
    </div>
  </header>

  <main id="main-content" class="py-6">
    <section class="text-white text-center py-12">
      <div class="container mx-auto px-4">
        <h2 class="text-4xl md:text-5xl font-bold mb-4 gold-text" data-key="hero_title">Welcome to Fashion Hub</h2>
        <p class="text-lg mb-6 max-w-2xl mx-auto text-gray-300" data-key="hero_sub">Discover luxury clothing, shoes and fragrances from our premium collection.</p>
        <a href="#products" class="premium-button px-6 py-3 rounded-lg font-bold" data-key="hero_cta">Shop Premium</a>
      </div>
    </section>

    <section id="products" class="py-8">
      <div class="container mx-auto px-4">
        <div class="flex items-center justify-between mb-6">
          <h3 class="text-2xl font-bold gold-text" data-key="products_title">Our Premium Collection</h3>
          <div class="flex gap-2">
            <button class="small-btn" onclick="openCart()">Cart (<span id="cart-count" class="hidden">0</span>)</button>
          </div>
        </div>

        <div class="grid grid-cols-1 md:grid-cols-3 gap-6" id="products-grid"></div>
      </div>
    </section>

    <section class="py-8 bg-gray-900">
      <div class="container mx-auto px-4 grid grid-cols-1 md:grid-cols-2 gap-8">
        <div class="bg-gray-800 p-6 rounded">
          <h4 class="text-xl font-semibold gold-text" data-key="suggest_title">Share Your Suggestion</h4>
          <form id="suggestion-form" class="mt-4">
            <input id="suggestion-name" placeholder="Your name" class="w-full p-2 mb-3 bg-gray-700 rounded" />
            <textarea id="suggestion-text" placeholder="Your suggestion..." class="w-full p-2 mb-3 bg-gray-700 rounded"></textarea>
            <button class="premium-button px-4 py-2 rounded" data-key="suggest_submit">Submit Suggestion</button>
          </form>
        </div>

        <div class="bg-gray-800 p-6 rounded">
          <h4 class="text-xl font-semibold gold-text" data-key="return_title">Return Policy</h4>
          <p class="text-gray-300 mt-2" data-key="return_text">We offer a 7-day return policy and 24-hour cancellation. Provide reason and photos for returns.</p>

          <form id="return-form" class="mt-4">
            <input id="return-order-number" placeholder="Order number" class="w-full p-2 mb-3 bg-gray-700 rounded" required />
            <textarea id="return-reason" placeholder="Reason for return" class="w-full p-2 mb-3 bg-gray-700 rounded" required></textarea>
            <input type="file" id="return-photo" class="mb-3"/>
            <button class="premium-button px-4 py-2 rounded" data-key="return_submit">Submit Return Request</button>
          </form>
        </div>
      </div>
    </section>

    <section id="contact" class="py-10">
      <div class="container mx-auto px-4 text-center">
        <h4 class="text-2xl font-semibold gold-text mb-4" data-key="contact_title">Contact Us</h4>
        <p class="text-gray-300">Phone: <span id="contact-phone" class="gold-text">9265247070</span></p>
        <p class="text-gray-300">Email: <a href="mailto:officialayan12@gmail.com" class="gold-text">officialayan12@gmail.com</a></p>
      </div>
    </section>
  </main>

  <section id="customer-dashboard" class="hidden py-8">
    <div class="container mx-auto px-4 grid grid-cols-1 md:grid-cols-3 gap-6">
      <div class="flex items-center gap-4 md:col-span-3 mb-4">
        <button onclick="showHomePage()" class="premium-button px-4 py-2 rounded font-semibold">Back to Home</button>
      </div>

      <div class="bg-gray-800 p-6 rounded">
        <h4 class="text-xl font-semibold gold-text" data-key="profile_title">My Profile</h4>
        <div class="mt-4">
          <p><strong data-key="label_name">Name:</strong> <span id="profile-display-name"></span></p>
          <p><strong data-key="label_email">Email:</strong> <span id="profile-display-email"></span></p>
          <p><strong data-key="label_age">Age:</strong> <span id="profile-display-age"></span></p>
          <p><strong data-key="label_gender">Gender:</strong> <span id="profile-display-gender"></span></p>
          <p><strong data-key="label_language">Language:</strong> <span id="profile-display-language"></span></p>
          <div class="mt-4">
            <button class="premium-button px-3 py-2 rounded" onclick="openProfileModal()" data-key="btn_edit_profile">Edit Profile</button>
          </div>
        </div>
      </div>

      <div class="md:col-span-2 bg-gray-800 p-6 rounded">
        <h4 class="text-xl font-semibold gold-text" data-key="my_orders">My Orders</h4>
        <div id="customer-orders-list" class="mt-4 overflow-auto max-h-96"></div>
      </div>
    </div>

    <div class="container mx-auto px-4 mt-6">
      <div class="bg-gray-800 p-6 rounded">
        <h4 class="text-xl font-semibold gold-text" data-key="my_suggestions">My Suggestions</h4>
        <div id="my-suggestions-list" class="mt-3"></div>
      </div>
    </div>
  </section>

  <section id="admin-panel" class="hidden py-8">
    <div class="container mx-auto px-4">
      <div class="flex items-center gap-4 mb-4">
        <button onclick="showHomePage()" class="premium-button px-4 py-2 rounded font-semibold">Back to Home</button>
      </div>

      <h2 class="text-2xl font-bold gold-text mb-4">Admin Dashboard</h2>

      <div class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-6">
        <div class="bg-gray-800 p-4 rounded">
          <p class="text-sm text-gray-300">Total Sales</p>
          <p id="admin-total-sales" class="text-xl font-bold gold-text">₹0</p>
        </div>
        <div class="bg-gray-800 p-4 rounded">
          <p class="text-sm text-gray-300">Total Orders</p>
          <p id="admin-total-orders" class="text-xl font-bold gold-text">0</p>
        </div>
        <div class="bg-gray-800 p-4 rounded">
          <p class="text-sm text-gray-300">Margin (after delivery)</p>
          <p id="admin-margin" class="text-xl font-bold gold-text">₹0</p>
        </div>
        <div class="bg-gray-800 p-4 rounded">
          <p class="text-sm text-gray-300">Delivery Charge</p>
          <input id="admin-delivery-charge" type="number" class="w-full p-2 bg-gray-700 rounded mt-2" />
          <button class="premium-button w-full mt-2 py-2 rounded" onclick="saveDeliveryCharge()">Save</button>
        </div>
      </div>

      <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
        <div class="bg-gray-800 p-4 rounded">
          <h4 class="text-lg font-semibold gold-text">Orders</h4>
          <div id="admin-orders-list" class="mt-3 overflow-auto max-h-96"></div>
        </div>

        <div class="bg-gray-800 p-4 rounded">
          <h4 class="text-lg font-semibold gold-text">Products</h4>
          <div class="mt-3">
            <form id="admin-add-product" class="grid grid-cols-1 gap-2">
              <input id="admin-prod-id" placeholder="Product ID (unique)" class="p-2 bg-gray-700 rounded" required />
              <input id="admin-prod-name" placeholder="Product name" class="p-2 bg-gray-700 rounded" required />
              <input id="admin-prod-price" placeholder="Price" type="number" class="p-2 bg-gray-700 rounded" required />
              <input id="admin-prod-stock" placeholder="Stock count" type="number" class="p-2 bg-gray-700 rounded" required />
              <input id="admin-prod-image" placeholder="Image URL" class="p-2 bg-gray-700 rounded" />
              <div class="flex gap-2">
                <button class="premium-button px-3 py-2 rounded" type="button" onclick="adminAddOrUpdateProduct()">Add / Update Product</button>
                <button class="bg-red-600 px-3 py-2 rounded" type="button" onclick="adminDeleteProduct()">Delete Product</button>
              </div>
            </form>
          </div>

          <div class="mt-4">
            <h5 class="text-sm text-gray-300">Stock Notifications (stock ≤ threshold)</h5>
            <div id="stock-notifications" class="mt-2"></div>
          </div>
        </div>
      </div>

      <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mt-6">
        <div class="bg-gray-800 p-4 rounded">
          <h4 class="text-lg font-semibold gold-text">Returns</h4>
          <div id="admin-returns-list" class="mt-3 overflow-auto max-h-64"></div>
        </div>

        <div class="bg-gray-800 p-4 rounded">
          <h4 class="text-lg font-semibold gold-text">Suggestions</h4>
          <div id="admin-suggestions-list" class="mt-3 overflow-auto max-h-64"></div>
        </div>
      </div>
    </div>
  </section>

  <div id="cart-modal" class="fixed inset-0 bg-black bg-opacity-60 hidden z-40 flex items-center justify-center">
    <div class="bg-gray-800 rounded-lg p-6 max-w-lg w-full mx-4">
      <h3 class="text-xl font-bold gold-text" data-key="cart_title">Your Cart</h3>
      <ul id="cart-items" class="mt-4"></ul>
      <p id="cart-total" class="mt-4 font-bold text-lg gold-text">Total: ₹0</p>
      <div class="flex gap-2 mt-4">
        <button onclick="closeCart()" class="bg-gray-700 text-white px-3 py-2 rounded" data-key="btn_close">Close</button>
        <button onclick="checkout()" id="checkoutBtn" class="premium-button px-3 py-2 rounded" data-key="btn_checkout">Checkout</button>
      </div>
    </div>
  </div>

  <div id="login-modal" class="fixed inset-0 bg-black bg-opacity-60 hidden z-50 flex items-center justify-center">
    <div class="bg-gray-800 rounded-lg p-6 max-w-md w-full mx-4 relative">
      <h3 class="text-xl font-bold gold-text text-center" data-key="auth_title">Login / Sign Up</h3>

      <div class="flex justify-center gap-2 mt-4">
        <button id="login-tab" class="modal-tab-button active" onclick="showLoginTab()" data-key="tab_login">Login</button>
        <button id="signup-tab" class="modal-tab-button" onclick="showSignupTab()" data-key="tab_signup">Sign Up</button>
      </div>

      <div id="login-form-container" class="mt-4">
        <input id="login-phone-number" placeholder="Phone number" class="w-full p-2 mb-3 bg-gray-700 rounded" />
        <div class="relative mb-3">
          <input id="login-password-field" type="password" placeholder="Password" class="w-full p-2 bg-gray-700 rounded" />
          <span class="eye-btn" onclick="togglePassword('login-password-field')">👁</span>
        </div>
        <button class="premium-button w-full py-2 rounded" onclick="loginUser()" data-key="btn_login">Login</button>
        <button class="w-full mt-2 text-sm text-gray-300" onclick="showForgotPassword()" data-key="link_forgot">Forgot password?</button>
      </div>

      <div id="signup-form-container" class="hidden mt-4">
        <input id="signup-phone-number" placeholder="Phone number" class="w-full p-2 mb-3 bg-gray-700 rounded" />
        <div class="relative mb-3">
          <input id="signup-password-field" type="password" placeholder="New password" class="w-full p-2 bg-gray-700 rounded" />
          <span class="eye-btn" onclick="togglePassword('signup-password-field')">👁</span>
        </div>
        <div class="relative mb-3">
          <input id="signup-confirm-password" type="password" placeholder="Confirm password" class="w-full p-2 bg-gray-700 rounded" />
          <span class="eye-btn" onclick="togglePassword('signup-confirm-password')">👁</span>
        </div>
        <input id="signup-age" type="number" placeholder="Age" class="w-full p-2 mb-3 bg-gray-700 rounded" />
        <button class="premium-button w-full py-2 rounded" onclick="signupUser()" data-key="btn_signup">Create account</button>
      </div>

      <div id="forgot-password-container" class="hidden mt-4">
        <input id="forgot-phone-number" placeholder="Your phone number" class="w-full p-2 mb-3 bg-gray-700 rounded" />
        <input id="forgot-age" placeholder="Your age" type="number" class="w-full p-2 mb-3 bg-gray-700 rounded" />
        <p id="age-hint" class="text-sm text-gray-400 mb-3 hidden" data-key="age_hint">Enter the age saved in your profile.</p>
        <button class="premium-button w-full py-2 rounded" onclick="forgotPassword()" data-key="btn_verify">Verify</button>

        <div id="reset-password-section" class="hidden mt-4">
          <div class="relative mb-3">
            <input id="new-password" type="password" placeholder="Enter new password" class="w-full p-2 bg-gray-700 rounded" />
            <span class="eye-btn" onclick="togglePassword('new-password')">👁</span>
          </div>
          <div class="relative mb-3">
            <input id="confirm-new-password" type="password" placeholder="Confirm new password" class="w-full p-2 bg-gray-700 rounded" />
            <span class="eye-btn" onclick="togglePassword('confirm-new-password')">👁</span>
          </div>
          <button class="premium-button w-full py-2 rounded" onclick="resetPassword()" data-key="btn_set_new">Set new password</button>
        </div>
      </div>

      <button class="mt-4 w-full text-gray-300" onclick="closeLoginModal()" data-key="btn_close">Close</button>
    </div>
  </div>

  <div id="profile-modal" class="fixed inset-0 bg-black bg-opacity-60 hidden z-50 flex items-center justify-center">
    <div class="bg-gray-800 rounded-lg p-6 max-w-md w-full mx-4">
      <h3 class="text-lg font-bold gold-text" data-key="profile_title">Edit Profile</h3>
      <form id="profile-form" class="mt-3">
        <input id="profile-name" placeholder="Full name" class="w-full p-2 mb-2 bg-gray-700 rounded" required />
        <input id="profile-email" placeholder="Email" type="email" class="w-full p-2 mb-2 bg-gray-700 rounded" required />
        <input id="profile-age" placeholder="Age" type="number" class="w-full p-2 mb-2 bg-gray-700 rounded" required />
        <select id="profile-gender" class="w-full p-2 mb-2 bg-gray-700 rounded" required>
          <option value="">Select gender</option><option>Male</option><option>Female</option><option>Other</option>
        </select>
        <select id="profile-language" class="w-full p-2 mb-2 bg-gray-700 rounded" required>
          <option value="en">English</option><option value="hi">हिन्दी</option><option value="gu">ગુજરાતી</option>
        </select>
        <button class="premium-button w-full py-2 rounded" type="submit" data-key="profile_save">Save profile</button>
      </form>
      <button class="mt-3 w-full text-gray-300" onclick="closeProfileModal()" data-key="btn_close">Close</button>
    </div>
  </div>

  <div id="checkout-modal" class="fixed inset-0 bg-black bg-opacity-60 hidden z-50 flex items-center justify-center">
    <div class="bg-gray-800 rounded-lg p-6 max-w-md w-full mx-4">
      <h3 class="text-lg font-bold gold-text" data-key="checkout_title">Enter shipping details</h3>
      <form id="checkout-form" class="mt-3">
        <input id="checkout-address" placeholder="Address" class="w-full p-2 mb-2 bg-gray-700 rounded" required />
        <input id="checkout-city" placeholder="City" class="w-full p-2 mb-2 bg-gray-700 rounded" required />
        <input id="checkout-state" placeholder="State" class="w-full p-2 mb-2 bg-gray-700 rounded" required />
        <input id="checkout-pincode" placeholder="Pincode" class="w-full p-2 mb-2 bg-gray-700 rounded" required />
        <select id="payment-method" class="w-full p-2 mb-2 bg-gray-700 rounded" required>
          <option value="">Select payment method</option>
          <option value="UPI">UPI</option><option value="COD">Cash on Delivery</option>
        </select>

        <div id="upi-details" class="hidden">
          <input id="upi-id" placeholder="Enter UPI ID" class="w-full p-2 mb-2 bg-gray-700 rounded" />
          <button type="button" onclick="verifyUpi()" class="bg-gray-700 text-white px-3 py-2 rounded">Verify UPI</button>
          <p id="upi-name" class="mt-2 text-sm gold-text"></p>
        </div>

        <button class="premium-button w-full py-2 rounded mt-3" type="submit" data-key="checkout_place">Place order</button>
      </form>
      <button class="mt-3 w-full text-gray-300" onclick="closeCheckoutModal()" data-key="btn_close">Close</button>
    </div>
  </div>

  <footer class="bg-gray-900 text-white py-6 mt-8">
    <div class="container mx-auto px-4 text-center">
      <p>&copy; <span id="year"></span> Fashion Hub. All rights reserved.</p>
    </div>
  </footer>

  <script>
    // ---------------------------
    // TRANSLATIONS (kept and extended)
    // ---------------------------
    const translations = {
      en: {
        nav_products: "Products", nav_return: "Return Policy", nav_contact: "Contact",
        btn_login: "Login", btn_signup: "Create account", btn_dashboard: "My Dashboard",
        btn_profile: "Profile", btn_logout: "Logout", hero_title: "Welcome to Fashion Hub",
        hero_sub: "Discover luxury clothing, shoes and fragrances from our premium collection.",
        hero_cta: "Shop Premium", products_title: "Our Premium Collection",
        suggest_title: "Share Your Suggestion", suggest_submit: "Submit Suggestion",
        return_title: "Return Policy", return_text: "We offer a 7-day return policy and 24-hour cancellation. Provide reason and photos for returns.",
        return_submit: "Submit Return Request", contact_title: "Contact Us",
        cart_title: "Your Cart", btn_close: "Close", btn_checkout: "Checkout",
        auth_title: "Login / Sign Up", tab_login: "Login", tab_signup: "Sign Up",
        link_forgot: "Forgot password?", age_hint: "Enter the age saved in your profile.",
        btn_verify: "Verify", btn_set_new: "Set new password", profile_title: "My Profile",
        profile_save: "Save profile", checkout_title: "Enter shipping details",
        checkout_place: "Place order", suggest_submitted: "Suggestion submitted.",
        return_submitted: "Return request submitted. We'll contact you soon.",
        in_stock: "In stock", out_of_stock: "Out of stock", add_to_cart: "Add to cart",
        view_orders: "View orders", expected_delivery: "Expected delivery", tracking_status: "Status",
        approve: "Approve", reject: "Reject", set_delivery: "Set delivery",
        total_sales: "Total Sales", total_orders: "Total Orders", margin: "Margin",
        delivery_charge_label: "Delivery Charge", change_delivery_charge: "Change delivery charge",
        add_product: "Add product", edit_product: "Edit", delete_product: "Delete",
        stock_notification: "Low stock", reply: "Reply", order_approved: "Order approved",
        order_rejected: "Order rejected", product_added: "Product added/updated", product_deleted: "Product deleted"
      },
      hi: {
        nav_products: "Products", nav_return: "Return Policy", nav_contact: "Contact",
        btn_login: "लॉगिन", btn_signup: "एकाउंट बनाएं", btn_dashboard: "मेरा डैशबोर्ड",
        btn_profile: "प्रोफ़ाइल", btn_logout: "लोग आउट", hero_title: "Fashion Hub में आपका स्वागत है",
        hero_sub: "हमारे प्रीमियम कलेक्शन से कपड़े, जूते और इत्र की लक्ज़री खोजें।",
        hero_cta: "शॉप प्रीमियम", products_title: "हमारा प्रीमियम कलेक्शन",
        suggest_title: "अपनी सुझाव साझा करें", suggest_submit: "सुझाव भेजें",
        return_title: "वापसी नीति", return_text: "हम 7-दिन की रिटर्न पॉलिसी और 24 घंटे की कैंसलेशन पेश करते हैं।",
        return_submit: "रिटर्न अनुरोध भेजें", contact_title: "संपर्क करें",
        cart_title: "आपका कार्ट", btn_close: "बंद करें", btn_checkout: "चेकआउट",
        auth_title: "लॉगिन / साइन अप", tab_login: "लॉगिन", tab_signup: "साइन अप",
        link_forgot: "पासवर्ड भूल गए?", age_hint: "अपने प्रोफ़ाइल में सहेजी गई उम्र दर्ज करें।",
        btn_verify: "सत्यापित करें", btn_set_new: "नया पासवर्ड सेट करें", profile_title: "मेरा प्रोफ़ाइल",
        profile_save: "प्रोफ़ाइल सहेजें", checkout_title: "शिपिंग विवरण दर्ज करें",
        checkout_place: "ऑर्डर दें", suggest_submitted: "सुझाव भेज दिया गया।",
        return_submitted: "रिटर्न अनुरोध भेज दिया गया। हम जल्द संपर्क करेंगे।",
        in_stock: "स्टॉक में है", out_of_stock: "स्टॉक समाप्त", add_to_cart: "कार्ट में डालें",
        view_orders: "ऑर्डर्स देखें", expected_delivery: "अपेक्षित डिलीवरी", tracking_status: "स्थिति",
        approve: "मंजूर करें", reject: "अस्वीकार करें", set_delivery: "डिलीवरी सेट करें",
        total_sales: "कुल बिक्री", total_orders: "कुल ऑर्डर्स", margin: "मुनाफ़ा",
        delivery_charge_label: "डिलीवरी चार्ज", change_delivery_charge: "डिलीवरी चार्ज बदलें",
        add_product: "प्रोडक्ट जोड़ें", edit_product: "संपादित", delete_product: "हटाएं",
        stock_notification: "कम स्टॉक", reply: "जवाब दें", order_approved: "ऑर्डर मंजूर हुआ",
        order_rejected: "ऑर्डर अस्वीकार", product_added: "प्रोडक्ट जोड़ा/अपडेट किया", product_deleted: "प्रोडक्ट हटाया"
      },
      gu: {
        nav_products: "Products", nav_return: "Return Policy", nav_contact: "Contact",
        btn_login: "લોગિન", btn_signup: "એકાઉન્ટ બનાવો", btn_dashboard: "મારું ડેશબોર્ડ",
        btn_profile: "પ્રોફાઇલ", btn_logout: "લોગઆઉટ", hero_title: "ફેશન હબમાં તમારું સ્વાગત છે",
        hero_sub: "અમારા પ્રીમિયમ કલેક્શનમાંથી કપડાં,जूતાં અને પરફ્યુમ શોધો.",
        hero_cta: "પ્રીમિયમ ખરીદો", products_title: "અમારું પ્રીમિયમ કલેક્શન",
        suggest_title: "તમારું સૂચન શેર કરો", suggest_submit: "સૂચન સબમિટ કરો",
        return_title: "રિટર્ન પોલિસી", return_text: "અમે 7 દિવસની રિટર્ન પોલિસી અને 24 કલાકનું કેન્સલેશન ઓફર કરીએ છીએ.",
        return_submit: "રિટર્ન રિક્વેસ્ટ સબમિટ કરો", contact_title: "સંપર્ક કરો",
        cart_title: "તમારું કાર્ટ", btn_close: "બંધ કરો", btn_checkout: "ચેકઆઉટ",
        auth_title: "લોગિન / સાઇનઅપ", tab_login: "લોગિન", tab_signup: "સાઇનઅપ",
        link_forgot: "પાસવર્ડ ભૂલી ગયા છો?", age_hint: "તમારી પ્રોફાઇલમાં સેવ કરેલી ઉંમર દાખલ કરો.",
        btn_verify: "વેરિફાઈ કરો", btn_set_new: "નવો પાસવર્ડ સેટ કરો", profile_title: "મારી પ્રોફાઇલ",
        profile_save: "પ્રોફાઇલ સાચવો", checkout_title: "શિપિંગ વિગતો દાખલ કરો",
        checkout_place: "ઓર્ડર આપો", suggest_submitted: "સૂચન સબમિટ થઈ ગયું.",
        return_submitted: "રિટર્ન રિક્વેસ્ટ સબમિટ થઈ ગઈ. અમે જલ્દી સંપર્ક કરીશું.",
        in_stock: "સ્ટોક માં છે", out_of_stock: "આઉટ ઓફ સ્ટોક", add_to_cart: "કાર્ટમાં ઉમેરો",
        view_orders: "ઓર્ડર્સ જુઓ", expected_delivery: "અંદાજિત ડિલિવરી", tracking_status: "સ્થિતિ",
        approve: "મંજૂર કરો", reject: "નકારી દો", set_delivery: "ડિલિવરી સેટ કરો",
        total_sales: "કુલ વેચાણ", total_orders: "કુલ ઓર્ડર્સ", margin: "માર્જિન",
        delivery_charge_label: "ડિલિવરી ચાર્જ", change_delivery_charge: "ડિલિવરી ચાર્જ બદલો",
        add_product: "પ્રોડક્ટ ઉમેરો", edit_product: "સંપાદિત", delete_product: "ડિલીટ",
        stock_notification: "ઓલડ સ્ટોક", reply: "જવાબ આપો", order_approved: "ઓર્ડર મંજૂર",
        order_rejected: "ઓર્ડર નકારી",
        product_added: "પ્રોડક્ટ ઉમેરાઈ/અપડેટ", product_deleted: "પ્રોડક્ટ ડિલીટ"
      }
    };

    // ---------------------------
    // HELPER: apply translations
    // ---------------------------
    function applyTranslations(lang) {
      document.querySelectorAll('[data-key]').forEach(el => {
        const key = el.getAttribute('data-key');
        if (translations[lang] && translations[lang][key]) el.textContent = translations[lang][key];
      });
      // placeholders
      const placeholders = {
        login_phone: { en: "Phone number", hi: "फोन नंबर", gu: "ફોન નંબર" },
        login_password: { en: "Password", hi: "पासवर्ड", gu: "પાસવર્ડ" },
        signup_phone: { en: "Phone number", hi: "फोन नंबर", gu: "ફોન નંબર" },
        signup_password: { en: "New password", hi: "नया पासवर्ड", gu: "નવો પાસવર્ડ" },
        signup_confirm: { en: "Confirm password", hi: "पासवर्ड कन्फर्म करें", gu: "પાસવર્ડ કન્ફર્મ કરો" },
        signup_age: { en: "Age", hi: "उम्र", gu: "ઉંમર" },
        forgot_phone: { en: "Your phone number", hi: "आपका फोन नंबर", gu: "તમારો ફોન નંબર" },
        forgot_age: { en: "Your age", hi: "आपकी उम्र", gu: "તમારી ઉંમર" },
        new_pw: { en: "Enter new password", hi: "नया पासवर्ड दर्ज करें", gu: "નવો પાસવર્ડ દાખલ કરો" },
        confirm_new_pw: { en: "Confirm new password", hi: "नया पासवर्ड कन्फर्म करें", gu: "પાસવર્ડ કન્ફર્મ કરો" },
        profile_name: { en: "Full name", hi: "पूरा नाम", gu: "પૂરૂં નામ" }
      };
      document.getElementById('login-phone-number').placeholder = placeholders.login_phone[lang];
      document.getElementById('login-password-field').placeholder = placeholders.login_password[lang];
      document.getElementById('signup-phone-number').placeholder = placeholders.signup_phone[lang];
      document.getElementById('signup-password-field').placeholder = placeholders.signup_password[lang];
      document.getElementById('signup-confirm-password').placeholder = placeholders.signup_confirm[lang];
      document.getElementById('signup-age').placeholder = placeholders.signup_age[lang];
      document.getElementById('forgot-phone-number').placeholder = placeholders.forgot_phone[lang];
      document.getElementById('forgot-age').placeholder = placeholders.forgot_age[lang];
      document.getElementById('new-password').placeholder = placeholders.new_pw[lang];
      document.getElementById('confirm-new-password').placeholder = placeholders.confirm_new_pw[lang];
      document.getElementById('profile-name').placeholder = placeholders.profile_name[lang];

      // update some dynamic contact or year
      document.getElementById('contact-phone').textContent = (lang === 'hi' ? 'फोन: 9265247070' : (lang === 'gu' ? 'ફોન: 9265247070' : 'Phone: 9265247070'));
      document.getElementById('year').textContent = new Date().getFullYear();
    }

    function setLanguage(lang) {
      localStorage.setItem('siteLang', lang);
      document.getElementById('langSelect').value = lang;
      applyTranslations(lang);
      // re-render product labels, admin lists to update in_stock/out_of_stock words
      renderProducts();
      renderAdminPanel(); // safe call; will no-op if admin hidden
      renderCustomerOrdersList();
    }

    // init language
    const savedLang = localStorage.getItem('siteLang') || 'en';
    document.getElementById('langSelect').value = savedLang;
    applyTranslations(savedLang);

    // ---------------------------
    // CORE DATA & CONFIG
    // ---------------------------
    let cart = [];
    let customers = JSON.parse(localStorage.getItem('customers')) || {};
    let suggestions = JSON.parse(localStorage.getItem('suggestions')) || [];
    let returnRequests = JSON.parse(localStorage.getItem('returnRequests')) || [];
    let globalOrders = JSON.parse(localStorage.getItem('globalOrders')) || []; // admin-level orders collection
    let currentUserId = localStorage.getItem('currentUserId') || null;
    let tempForgotPhone = null;

    const adminPhone = '9265247070';
    const adminPassword = 'AK GAMING 1M';

    // delivery charge (admin editable)
    let deliveryCharge = Number(localStorage.getItem('deliveryCharge') || 50);
    document.getElementById('admin-delivery-charge').value = deliveryCharge;

    let allProducts = JSON.parse(localStorage.getItem('allProducts')) || {
      'men-basic-tshirt': { name: "Men's Basic T-Shirt", price: 599, stock: 10, image: 'https://images.unsplash.com/photo-1621323862287-c1d48c9a6231?q=80&w=1887&auto=format&fit=crop' },
      'women-designer-dress': { name: "Women's Designer Dress", price: 6999, stock: 2, image: 'https://images.unsplash.com/photo-1627051996963-8a9d0a649b5c?q=80&w=1887&auto=format&fit=crop' },
      'men-leather-jacket': { name: "Men's Leather Jacket", price: 4999, stock: 3, image: 'https://images.unsplash.com/photo-1616016149206-89d4432c66d6?q=80&w=1935&auto=format&fit=crop' }
    };

    // ---------------------------
    // RENDER PRODUCTS (customer visible)
    // ---------------------------
    function renderProducts() {
      const grid = document.getElementById('products-grid');
      grid.innerHTML = '';
      const lang = localStorage.getItem('siteLang') || 'en';
      for (const id in allProducts) {
        const p = allProducts[id];
        const node = document.createElement('div');
        node.className = 'product-card p-4 rounded shadow-sm';
        const stockText = p.stock > 0 ? (translations[lang].in_stock || 'In stock') : (translations[lang].out_of_stock || 'Out of stock');
        const addBtn = p.stock > 0 ? `<button class="premium-button px-3 py-2 rounded w-full" onclick="addToCart('${id}')">${translations[lang].add_to_cart || 'Add to cart'}</button>` : `<button class="bg-gray-700 text-gray-400 px-3 py-2 rounded w-full" disabled>${translations[lang].out_of_stock || 'Out of stock'}</button>`;
        node.innerHTML = `
          <img src="${p.image}" alt="${p.name}" class="w-full h-48 object-cover rounded mb-3">
          <h4 class="font-semibold text-lg gold-text">${p.name}</h4>
          <p class="text-gray-300 mt-1">₹${p.price}</p>
          <p class="text-sm ${p.stock>0?'text-green-400':'text-red-400'}">${stockText}</p>
          <div class="mt-3">${addBtn}</div>
          <div class="mt-2"><button class="small-btn" onclick="openProductDetails('${id}')">Details</button></div>
        `;
        grid.appendChild(node);
      }
    }

    function openProductDetails(id) {
      const p = allProducts[id];
      alert(`${p.name}\nPrice: ₹${p.price}\nStock: ${p.stock}`);
    }

    // ---------------------------
    // CART LOGIC
    // ---------------------------
    function addToCart(productId) {
      const p = allProducts[productId];
      if (!p || p.stock <= 0) { alert('Product out of stock'); return; }
      const ex = cart.find(i => i.id === productId);
      if (ex) ex.qty++; else cart.push({ id: productId, name: p.name, price: p.price, qty: 1 });
      updateCartCount();
      alert(p.name + ' added to cart');
    }

    function updateCartCount() {
      const total = cart.reduce((s,i)=>s+i.qty,0);
      const el = document.getElementById('cart-count');
      if (!el) return;
      if (total>0) { el.textContent = total; el.classList.remove('hidden'); } else { el.classList.add('hidden'); }
    }

    function openCart() {
      renderCart();
      document.getElementById('cart-modal').classList.remove('hidden');
    }
    function closeCart() { document.getElementById('cart-modal').classList.add('hidden'); }

    function renderCart() {
      const list = document.getElementById('cart-items');
      list.innerHTML = '';
      let total = 0;
      if (cart.length === 0) {
        list.innerHTML = `<li class="text-gray-400">Your cart is empty.</li>`;
      } else {
        cart.forEach(item => {
          const li = document.createElement('li');
          li.className = 'flex justify-between items-center py-2 border-b border-gray-700';
          li.innerHTML = `<div><span class="gold-text">${item.name}</span> <span class="text-gray-300"> (₹${item.price} x ${item.qty})</span></div>
                          <div><strong>₹${item.price*item.qty}</strong> <button class="ml-3 text-red-400" onclick="removeFromCart('${item.id}')">Remove</button></div>`;
          list.appendChild(li);
          total += item.price*item.qty;
        });
      }
      document.getElementById('cart-total').textContent = `Total: ₹${total}`;
    }

    function removeFromCart(id) {
      const idx = cart.findIndex(i=>i.id===id);
      if (idx>-1) {
        if (cart[idx].qty>1) cart[idx].qty--; else cart.splice(idx,1);
      }
      renderCart();
      updateCartCount();
    }

    // ---------------------------
    // AUTH (login/signup/forgot)
    // ---------------------------
    function openLoginModal() { document.getElementById('login-modal').classList.remove('hidden'); showLoginTab(); }
    function closeLoginModal() { document.getElementById('login-modal').classList.add('hidden'); }

    function showLoginTab(){
      document.getElementById('login-form-container').classList.remove('hidden');
      document.getElementById('signup-form-container').classList.add('hidden');
      document.getElementById('forgot-password-container').classList.add('hidden');
      document.getElementById('login-tab').classList.add('active');
      document.getElementById('signup-tab').classList.remove('active');
    }
    function showSignupTab(){
      document.getElementById('login-form-container').classList.add('hidden');
      document.getElementById('signup-form-container').classList.remove('hidden');
      document.getElementById('forgot-password-container').classList.add('hidden');
      document.getElementById('login-tab').classList.remove('active');
      document.getElementById('signup-tab').classList.add('active');
    }
    function showForgotPassword(){
      document.getElementById('login-form-container').classList.add('hidden');
      document.getElementById('signup-form-container').classList.add('hidden');
      document.getElementById('forgot-password-container').classList.remove('hidden');
    }

    function togglePassword(id){
      const f = document.getElementById(id);
      if (!f) return;
      f.type = f.type === 'password' ? 'text' : 'password';
    }

    function signupUser(){
      const phone = document.getElementById('signup-phone-number').value.trim();
      const pass = document.getElementById('signup-password-field').value;
      const conf = document.getElementById('signup-confirm-password').value;
      const age = document.getElementById('signup-age').value.trim();

      if (!phone || !pass || !conf) { alert('Fill all fields'); return; }
      if (customers[phone]) { alert('Account already exists'); return; }
      if (pass !== conf) { alert('Passwords do not match'); return; }

      customers[phone] = { password: pass, profile: { name:'', email:'', age: age, gender:'', language: localStorage.getItem('siteLang')||'en' }, orders: [], suggestions: [] };
      localStorage.setItem('customers', JSON.stringify(customers));
      alert('Account created. You can now login.');
      showLoginTab();
      document.getElementById('login-phone-number').value = phone;
    }

    function loginUser(){
      const phone = document.getElementById('login-phone-number').value.trim();
      const pass = document.getElementById('login-password-field').value;

      // admin login
      if (phone === adminPhone && pass === adminPassword) {
        currentUserId = 'admin';
        localStorage.setItem('currentUserId', 'admin');
        alert('Logged in as admin');
        updateLoginState();
        closeLoginModal();
        showAdminPanel();
        return;
      }

      const user = customers[phone];
      if (user && user.password === pass) {
        currentUserId = phone;
        localStorage.setItem('currentUserId', phone);
        alert('Login successful');
        updateLoginState();
        closeLoginModal();
        showCustomerProfile();
      } else alert('Wrong phone or password');
    }

    // Forgot password: age verify then allow reset
    function forgotPassword(){
      const phone = document.getElementById('forgot-phone-number').value.trim();
      const age = document.getElementById('forgot-age').value.trim();
      const ageHint = document.getElementById('age-hint');
      const cust = customers[phone];
      if (!cust) { alert('No account with this phone'); return; }

      if ((cust.profile && cust.profile.age) == age) {
        tempForgotPhone = phone;
        ageHint.classList.add('hidden');
        document.getElementById('reset-password-section').classList.remove('hidden');
      } else {
        alert('Age is incorrect. Enter correct age.');
        ageHint.classList.remove('hidden');
      }
    }

    function resetPassword() {
      const newPw = document.getElementById('new-password').value;
      const conf = document.getElementById('confirm-new-password').value;
      if (!tempForgotPhone || !customers[tempForgotPhone]) { alert('Try again'); return; }
      if (newPw !== conf) { alert('Passwords do not match'); return; }
      customers[tempForgotPhone].password = newPw;
      localStorage.setItem('customers', JSON.stringify(customers));
      alert('New password set. Please login.');
      document.getElementById('reset-password-section').classList.add('hidden');
      document.getElementById('forgot-password-container').classList.add('hidden');
      showLoginTab();
    }

    // ---------------------------
    // PROFILE (customer)
    // ---------------------------
    function openProfileModal(){
      if (!currentUserId || currentUserId === 'admin') { alert('Please login as customer'); return; }
      const p = customers[currentUserId].profile;
      document.getElementById('profile-name').value = p.name || '';
      document.getElementById('profile-email').value = p.email || '';
      document.getElementById('profile-age').value = p.age || '';
      document.getElementById('profile-gender').value = p.gender || '';
      document.getElementById('profile-language').value = p.language || (localStorage.getItem('siteLang')||'en');
      document.getElementById('profile-modal').classList.remove('hidden');
    }
    function closeProfileModal(){ document.getElementById('profile-modal').classList.add('hidden'); }

    document.getElementById('profile-form').addEventListener('submit', function(e){
      e.preventDefault();
      if (!currentUserId || currentUserId === 'admin') { alert('Invalid'); return; }
      const name = document.getElementById('profile-name').value.trim();
      const email = document.getElementById('profile-email').value.trim();
      const age = document.getElementById('profile-age').value.trim();
      const gender = document.getElementById('profile-gender').value;
      const language = document.getElementById('profile-language').value;
      customers[currentUserId].profile = { name, email, age, gender, language };
      localStorage.setItem('customers', JSON.stringify(customers));
      alert('Profile updated');
      closeProfileModal();
      setLanguage(language);
      renderCustomerProfile();
    });

    function renderCustomerProfile(){
      if (!currentUserId || currentUserId === 'admin') return;
      const p = customers[currentUserId].profile || {};
      document.getElementById('profile-display-name').textContent = p.name || '-';
      document.getElementById('profile-display-email').textContent = p.email || '-';
      document.getElementById('profile-display-age').textContent = p.age || '-';
      document.getElementById('profile-display-gender').textContent = p.gender || '-';
      document.getElementById('profile-display-language').textContent = p.language || (localStorage.getItem('siteLang')||'en');
    }

    // ---------------------------
    // ORDERS / CHECKOUT
    // ---------------------------
    document.getElementById('checkout-form').addEventListener('submit', function(e){
      e.preventDefault();
      if (!currentUserId || currentUserId === 'admin') { alert('Please login as customer'); openLoginModal(); return; }
      if (cart.length === 0) { alert('Cart empty'); return; }
      const address = document.getElementById('checkout-address').value.trim();
      const city = document.getElementById('checkout-city').value.trim();
      const state = document.getElementById('checkout-state').value.trim();
      const pincode = document.getElementById('checkout-pincode').value.trim();
      const paymentMethod = document.getElementById('payment-method').value;
      const total = cart.reduce((s,i)=>s + i.price*i.qty,0);
      const orderId = Date.now().toString();
      const expectedDeliveryDate = new Date(Date.now() + 7*24*60*60*1000).toLocaleDateString(); // default +7 days
      const order = { id: orderId, date: new Date().toLocaleDateString(), items: cart.slice(), total, address: `${address}, ${city}, ${state}, ${pincode}`, paymentMethod, status: 'Pending', expectedDelivery: expectedDeliveryDate, customerId: currentUserId };
      // push to customer's orders
      if (!customers[currentUserId].orders) customers[currentUserId].orders = [];
      customers[currentUserId].orders.push(order);
      // push to global admin orders
      globalOrders.push(order);

      // reduce stock
      cart.forEach(it => { if (allProducts[it.id]) allProducts[it.id].stock -= it.qty; });

      // persist
      localStorage.setItem('customers', JSON.stringify(customers));
      localStorage.setItem('globalOrders', JSON.stringify(globalOrders));
      localStorage.setItem('allProducts', JSON.stringify(allProducts));

      cart = []; updateCartCount(); renderProducts(); closeCheckoutModal();
      alert('Order placed! Total: ₹' + total);
      // refresh UI
      renderCustomerOrdersList();
      renderAdminPanel();
    });

    function checkout(){
      if (!currentUserId || currentUserId === 'admin') { openLoginModal(); return; }
      document.getElementById('checkout-modal').classList.remove('hidden');
      closeCart();
    }
    function closeCheckoutModal(){ document.getElementById('checkout-modal').classList.add('hidden'); }

    // ---------------------------
    // CUSTOMER ORDERS RENDER
    // ---------------------------
    function renderCustomerOrdersList(){
      const container = document.getElementById('customer-orders-list');
      container.innerHTML = '';
      if (!currentUserId || currentUserId === 'admin') return;
      const orders = customers[currentUserId].orders || [];
      if (orders.length === 0) { container.innerHTML = '<p class="text-gray-400">No orders yet.</p>'; return; }
      orders.slice().reverse().forEach(o => {
        const div = document.createElement('div');
        div.className = 'bg-gray-900 p-3 rounded mb-3';
        div.innerHTML = `<div class="flex justify-between items-center">
          <div><strong>Order #${o.id}</strong><div class="text-sm text-gray-400">${o.date}</div></div>
          <div class="text-right"><div class="gold-text">₹${o.total}</div><div class="text-sm">${o.status}</div></div>
        </div>
        <div class="mt-2"><button class="small-btn" onclick="showOrderDetails('${o.id}','customer')">View details</button></div>`;
        container.appendChild(div);
      });
    }

    function showOrderDetails(orderId, viewFor){
      // find order from globalOrders or customer's orders
      let order = globalOrders.find(o=>o.id===orderId);
      if (!order && currentUserId && customers[currentUserId].orders) order = customers[currentUserId].orders.find(o=>o.id===orderId);
      if (!order) { alert('Order not found'); return; }
      // build details
      let itemsHtml = '<ul>';
      order.items.forEach(it => itemsHtml += `<li>${it.name} x${it.qty} — ₹${it.price*it.qty}</li>`);
      itemsHtml += '</ul>';
      const tracking = `<p><strong>${translations[localStorage.getItem('siteLang')||'en'].expected_delivery || 'Expected delivery'}:</strong> ${order.expectedDelivery}</p>
                        <p><strong>${translations[localStorage.getItem('siteLang')||'en'].tracking_status || 'Status'}:</strong> ${order.status}</p>`;
      const extra = viewFor === 'admin' ? `<div class="mt-2">
        <label>Change status:</label>
        <select id="admin-change-status" class="p-1 bg-gray-700 rounded">
          <option>Pending</option><option>Approved</option><option>Rejected</option><option>Shipped</option><option>Delivered</option>
        </select>
        <input id="admin-expected-date" type="date" class="p-1 bg-gray-700 rounded ml-2" />
        <button class="premium-button px-3 py-1 rounded ml-2" onclick="adminUpdateOrder('${o.id}')">Save</button>
      </div>` : '';
      alert(`Order #${order.id}\nDate: ${order.date}\nTotal: ₹${order.total}\n\nItems:\n${order.items.map(i=>`${i.name} x${i.qty} — ₹${i.price*i.qty}`).join('\n')}\n\nExpected: ${order.expectedDelivery}\nStatus: ${order.status}`);
    }

    // ---------------------------
    // ADMIN: full panel rendering and actions
    // ---------------------------
    function showAdminPanel(){
      if (currentUserId !== 'admin') { alert('Admin login required'); return; }
      document.getElementById('main-content').classList.add('hidden');
      document.getElementById('customer-dashboard').classList.add('hidden');
      document.getElementById('admin-panel').classList.remove('hidden');
      renderAdminPanel();
    }

    function renderAdminPanel(){
      if (currentUserId !== 'admin') return;
      // summary
      const totalOrders = globalOrders.length;
      const totalSales = globalOrders.reduce((s,o)=>s + (o.total || 0), 0);
      // margin = sales - (deliveryCharge * orders)
      const marginVal = totalSales - (deliveryCharge * totalOrders);
      document.getElementById('admin-total-orders').textContent = totalOrders;
      document.getElementById('admin-total-sales').textContent = `₹${totalSales}`;
      document.getElementById('admin-margin').textContent = `₹${marginVal}`;
      document.getElementById('admin-delivery-charge').value = deliveryCharge;

      // orders list
      const ol = document.getElementById('admin-orders-list');
      ol.innerHTML = '';
      if (globalOrders.length === 0) ol.innerHTML = '<p class="text-gray-400">No orders yet.</p>';
      globalOrders.slice().reverse().forEach(o => {
        const cust = customers[o.customerId] ? (customers[o.customerId].profile.name || o.customerId) : o.customerId;
        const wrapper = document.createElement('div');
        wrapper.className = 'bg-gray-900 p-3 rounded mb-3';
        wrapper.innerHTML = `
          <div class="flex justify-between items-center">
            <div><strong>Order #${o.id}</strong><div class="text-sm text-gray-400">${o.date} — ${cust}</div></div>
            <div class="text-right"><div class="gold-text">₹${o.total}</div><div class="text-sm">${o.status}</div></div>
          </div>
          <div class="mt-2 text-sm text-gray-300">${o.items.map(i=>`${i.name} x${i.qty}`).join('; ')}</div>
          <div class="mt-2 flex gap-2">
            <button class="small-btn" onclick="adminOpenOrder('${o.id}')">Open</button>
            <button class="premium-button" onclick="adminApproveOrder('${o.id}')">${translations[savedLang].approve || 'Approve'}</button>
            <button class="bg-red-600 px-3 py-1 rounded" onclick="adminRejectOrder('${o.id}')">${translations[savedLang].reject || 'Reject'}</button>
          </div>
        `;
        ol.appendChild(wrapper);
      });

      // products
      const pn = document.getElementById('stock-notifications');
      pn.innerHTML = '';
      const lowList = Object.keys(allProducts).filter(k=>allProducts[k].stock <= 2); // threshold = 2
      if (lowList.length === 0) pn.innerHTML = '<div class="text-gray-400">All good</div>';
      lowList.forEach(k => {
        const p = allProducts[k];
        const d = document.createElement('div');
        d.className = 'p-2 mb-2 bg-gray-900 rounded';
        d.innerHTML = `<div><strong>${p.name}</strong> — ${p.stock} left <button class="small-btn ml-2" onclick="adminEditProductFill('${k}')">Edit</button></div>`;
        pn.appendChild(d);
      });

      // returns
      const rr = document.getElementById('admin-returns-list');
      rr.innerHTML = '';
      if (returnRequests.length === 0) rr.innerHTML = '<div class="text-gray-400">No return requests</div>';
      returnRequests.slice().reverse().forEach(r => {
        const d = document.createElement('div');
        d.className = 'p-2 mb-2 bg-gray-900 rounded';
        d.innerHTML = `<div><strong>Return #${r.id}</strong> — Order ${r.orderId} — ${r.status || 'Pending'}</div>
          <div class="text-sm text-gray-300">${r.reason}</div>
          <div class="mt-2"><button class="premium-button" onclick="adminApproveReturn('${r.id}')">Approve</button>
          <button class="bg-red-600 px-3 py-1 rounded" onclick="adminRejectReturn('${r.id}')">Reject</button></div>`;
        rr.appendChild(d);
      });

      // suggestions
      const sl = document.getElementById('admin-suggestions-list');
      sl.innerHTML = '';
      if (suggestions.length === 0) sl.innerHTML = '<div class="text-gray-400">No suggestions</div>';
      suggestions.slice().reverse().forEach((s, idx) => {
        const d = document.createElement('div'); d.className = 'p-2 mb-2 bg-gray-900 rounded';
        d.innerHTML = `<div><strong>${s.name}</strong> — ${s.date}</div><div class="text-sm text-gray-300">${s.text}</div>
          <div class="mt-2"><input id="reply-${idx}" placeholder="Write reply..." class="p-2 bg-gray-700 rounded w-full" />
          <button class="premium-button mt-2 w-full" onclick="adminReplySuggestion(${idx})">Reply</button></div>`;
        sl.appendChild(d);
      });
    }

    function adminOpenOrder(id){
      const o = globalOrders.find(x=>x.id===id);
      if (!o) return alert('Order not found');
      const cust = customers[o.customerId] ? (customers[o.customerId].profile.name || o.customerId) : o.customerId;
      const items = o.items.map(i=>`${i.name} x${i.qty} — ₹${i.price*i.qty}`).join('\n');
      const newStatus = prompt('Change status (Pending / Approved / Rejected / Shipped / Delivered):', o.status);
      if (newStatus) {
        o.status = newStatus;
        const newDate = prompt('Expected delivery date (yyyy-mm-dd):', o.expectedDelivery ? new Date(o.expectedDelivery).toISOString().slice(0,10) : '');
        if (newDate) o.expectedDelivery = new Date(newDate).toLocaleDateString();
        saveAllState();
        renderAdminPanel();
        renderCustomerOrdersList();
        alert('Order updated');
      }
    }

    function adminApproveOrder(id){
      const o = globalOrders.find(x=>x.id===id);
      if (!o) return alert('Order not found');
      o.status = 'Approved';
      saveAllState();
      renderAdminPanel();
      renderCustomerOrdersList();
      alert('Order approved');
    }
    function adminRejectOrder(id){
      const o = globalOrders.find(x=>x.id===id);
      if (!o) return alert('Order not found');
      o.status = 'Rejected';
      saveAllState();
      renderAdminPanel();
      renderCustomerOrdersList();
      alert('Order rejected');
    }

    function adminUpdateOrder(id){
      const newStatus = document.getElementById('admin-change-status').value;
      const newDate = document.getElementById('admin-expected-date').value;
      const o = globalOrders.find(x=>x.id===id);
      if (!o) return alert('Order not found');
      o.status = newStatus;
      if (newDate) o.expectedDelivery = new Date(newDate).toLocaleDateString();
      saveAllState();
      renderAdminPanel();
      renderCustomerOrdersList();
      alert('Saved');
    }

    function adminApproveReturn(id){
      const r = returnRequests.find(x=>x.id===id);
      if (!r) return;
      r.status = 'Approved';
      saveAllState();
      renderAdminPanel();
      alert('Return approved');
    }
    function adminRejectReturn(id){
      const r = returnRequests.find(x=>x.id===id);
      if (!r) return;
      r.status = 'Rejected';
      saveAllState();
      renderAdminPanel();
      alert('Return rejected');
    }

    function adminReplySuggestion(idx){
      const reply = document.getElementById('reply-'+idx).value.trim();
      if (!reply) return alert('Enter reply');
      // attach reply to suggestion record
      const realIdx = suggestions.length - 1 - idx; // reversed view mapping
      suggestions[realIdx].reply = reply;
      localStorage.setItem('suggestions', JSON.stringify(suggestions));
      renderAdminPanel();
      alert('Replied');
    }

    // ---------------------------
    // ADMIN: product management
    // ---------------------------
    function adminAddOrUpdateProduct(){
      const id = document.getElementById('admin-prod-id').value.trim();
      const name = document.getElementById('admin-prod-name').value.trim();
      const price = Number(document.getElementById('admin-prod-price').value);
      const stock = Number(document.getElementById('admin-prod-stock').value);
      const image = document.getElementById('admin-prod-image').value.trim() || 'https://via.placeholder.com/400x400?text=Product';

      if (!id || !name || !price) return alert('Fill product id, name, price');
      allProducts[id] = { name, price, stock, image };
      localStorage.setItem('allProducts', JSON.stringify(allProducts));
      renderProducts();
      renderAdminPanel();
      alert(translations[savedLang].product_added || 'Product added/updated');
    }

    function adminDeleteProduct(){
      const id = document.getElementById('admin-prod-id').value.trim();
      if (!id || !allProducts[id]) return alert('Product id invalid');
      delete allProducts[id];
      localStorage.setItem('allProducts', JSON.stringify(allProducts));
      renderProducts();
      renderAdminPanel();
      alert(translations[savedLang].product_deleted || 'Product deleted');
    }

    function adminEditProductFill(id){
      if (!allProducts[id]) return;
      const p = allProducts[id];
      document.getElementById('admin-prod-id').value = id;
      document.getElementById('admin-prod-name').value = p.name;
      document.getElementById('admin-prod-price').value = p.price;
      document.getElementById('admin-prod-stock').value = p.stock;
      document.getElementById('admin-prod-image').value = p.image;
    }

    function saveDeliveryCharge(){
      const v = Number(document.getElementById('admin-delivery-charge').value || 0);
      deliveryCharge = v;
      localStorage.setItem('deliveryCharge', v);
      renderAdminPanel();
      alert('Delivery charge saved');
    }

    // ---------------------------
    // SUGGESTIONS & RETURNS (customer)
    // ---------------------------
    document.getElementById('suggestion-form').addEventListener('submit', function(e){
      e.preventDefault();
      const name = document.getElementById('suggestion-name').value.trim();
      const text = document.getElementById('suggestion-text').value.trim();
      if (!name || !text) { alert('Fill both fields'); return; }
      const newS = { name, text, date: new Date().toLocaleDateString(), reply: null };
      suggestions.push(newS);
      localStorage.setItem('suggestions', JSON.stringify(suggestions));
      alert(translations[localStorage.getItem('siteLang')||'en'].suggest_submitted || 'Suggestion submitted.');
      this.reset();
    });

    document.getElementById('return-form').addEventListener('submit', function(e){
      e.preventDefault();
      if (!currentUserId || currentUserId === 'admin') { alert('Please login'); return; }
      const orderId = document.getElementById('return-order-number').value.trim();
      const reason = document.getElementById('return-reason').value.trim();
      if (!orderId || !reason) { alert('Fill fields'); return; }
      const req = { id: Date.now().toString(), customerId: currentUserId, orderId, reason, status: 'Pending' };
      returnRequests.push(req);
      localStorage.setItem('returnRequests', JSON.stringify(returnRequests));
      alert(translations[localStorage.getItem('siteLang')||'en'].return_submitted || 'Return request submitted.');
      this.reset();
      renderAdminPanel();
    });

    // ---------------------------
    // UTILS: save to localStorage
    // ---------------------------
    function saveAllState(){
      localStorage.setItem('customers', JSON.stringify(customers));
      localStorage.setItem('globalOrders', JSON.stringify(globalOrders));
      localStorage.setItem('allProducts', JSON.stringify(allProducts));
      localStorage.setItem('suggestions', JSON.stringify(suggestions));
      localStorage.setItem('returnRequests', JSON.stringify(returnRequests));
    }

    // ---------------------------
    // NAV: show customer profile view
    // ---------------------------
    function showCustomerProfile(){
      if (!currentUserId || currentUserId === 'admin') { openLoginModal(); return; }
      document.getElementById('main-content').classList.add('hidden');
      document.getElementById('admin-panel').classList.add('hidden');
      document.getElementById('customer-dashboard').classList.remove('hidden');
      renderCustomerProfile();
      renderCustomerOrdersList();
      renderMySuggestions();
    }
    
    // New function to show homepage
    function showHomePage() {
      document.getElementById('main-content').classList.remove('hidden');
      document.getElementById('customer-dashboard').classList.add('hidden');
      document.getElementById('admin-panel').classList.add('hidden');
    }

    function renderMySuggestions(){
      const el = document.getElementById('my-suggestions-list');
      el.innerHTML = '';
      if (!currentUserId || currentUserId === 'admin') return;
      // show suggestions by this user (matching name & email not guaranteed) - show all suggestions and replies as demo
      suggestions.slice().reverse().forEach(s => {
        const d = document.createElement('div'); d.className = 'p-2 mb-2 bg-gray-900 rounded';
        d.innerHTML = `<div><strong>${s.name}</strong> — ${s.date}</div><div class="text-sm text-gray-300">${s.text}</div>
          <div class="mt-2 text-sm text-gray-400">${s.reply ? ('Reply: ' + s.reply) : ''}</div>`;
        el.appendChild(d);
      });
    }

    // ---------------------------
    // ADMIN quick helpers
    // ---------------------------
    function adminAddSampleOrdersForDemo(){ /* not used */ }

    // ---------------------------
    // INIT & UI state
    // ---------------------------
    function updateLoginState(){
      if (currentUserId) {
        document.getElementById('mainLoginBtn').classList.add('hidden');
        document.getElementById('logged-in-options').classList.remove('hidden');
        document.getElementById('logoutBtnTop').classList.remove('hidden');
        // show admin or profile nav
        if (currentUserId === 'admin') {
          document.getElementById('dashboardBtn').classList.remove('hidden');
          document.getElementById('profileNavBtn').classList.add('hidden');
        } else {
          document.getElementById('dashboardBtn').classList.add('hidden');
          document.getElementById('profileNavBtn').classList.remove('hidden');
        }
      } else {
        document.getElementById('mainLoginBtn').classList.remove('hidden');
        document.getElementById('logged-in-options').classList.add('hidden');
        document.getElementById('logoutBtnTop').classList.add('hidden');
      }
    }

    function logoutUser(){
      currentUserId = null;
      localStorage.removeItem('currentUserId');
      updateLoginState();
      document.getElementById('admin-panel').classList.add('hidden');
      document.getElementById('customer-dashboard').classList.add('hidden');
      document.getElementById('main-content').classList.remove('hidden');
    }

    // ---------------------------
    // PAYMENT helper
    // ---------------------------
    document.getElementById('payment-method').addEventListener('change', function(e){
      if (e.target.value === 'UPI') document.getElementById('upi-details').classList.remove('hidden'); else document.getElementById('upi-details').classList.add('hidden');
    });
    function verifyUpi(){ const id = document.getElementById('upi-id').value.trim(); if (id === 'fashionhub@upi') { document.getElementById('upi-name').textContent = 'Fashion Hub - Meman Ayan'; alert('UPI verified'); } else { document.getElementById('upi-name').textContent = 'Invalid UPI ID'; alert('Invalid UPI'); } }

    // ---------------------------
    // STARTUP
    // ---------------------------
    function init(){
      // load possible saved values
      cart = [];
      customers = JSON.parse(localStorage.getItem('customers')) || customers;
      suggestions = JSON.parse(localStorage.getItem('suggestions')) || suggestions;
      returnRequests = JSON.parse(localStorage.getItem('returnRequests')) || returnRequests;
      globalOrders = JSON.parse(localStorage.getItem('globalOrders')) || globalOrders;
      allProducts = JSON.parse(localStorage.getItem('allProducts')) || allProducts;
      deliveryCharge = Number(localStorage.getItem('deliveryCharge') || deliveryCharge);
      document.getElementById('admin-delivery-charge').value = deliveryCharge;
      currentUserId = localStorage.getItem('currentUserId') || currentUserId;

      renderProducts();
      updateLoginState();
      updateCartCount();
      // if logged in as customer, show profile by default
      if (currentUserId && currentUserId !== 'admin') showCustomerProfile();
      if (currentUserId === 'admin') showAdminPanel();
      applyTranslations(localStorage.getItem('siteLang') || 'en');
    }

    document.addEventListener('DOMContentLoaded', init);
  </script>
</body>
</html>
